<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Paint</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Full-screen Canvas Container -->
    <div class="canvas-container">
        <canvas id="canvas" width="800" height="600"></canvas>
        <input type="text" id="text-input" class="text-input-overlay" />
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Processing...</div>
        </div>
    </div>

    <!-- Floating Header -->
    <div id="floating-header" class="floating-header">
        <h1>Web Paint</h1>
        <button id="theme-toggle" class="theme-toggle-btn" title="Toggle Dark Mode (Ctrl+Shift+D)">
            <span class="theme-icon">‚òÄÔ∏è</span>
        </button>
    </div>

    <!-- Floating Toolbox (Draggable) -->
    <div id="floating-toolbox" class="floating-toolbox">
        <div class="toolbox-header" id="toolbox-drag-handle">
            <span class="toolbox-title">üé® Tools</span>
            <button id="toolbox-toggle" class="toolbox-toggle-btn" title="Minimize/Expand (Tab)">‚àí</button>
        </div>

        <div id="toolbox-content" class="toolbox-content">
            <!-- Drawing Tools -->
            <div class="tool-section">
                <div class="section-label">Drawing</div>
                <div class="tool-buttons">
                    <button id="tool-pen" class="tool-btn active" title="Pen (P)">‚úèÔ∏è</button>
                    <button id="tool-eraser" class="tool-btn" title="Eraser (E)">‚¨ú</button>
                    <button id="tool-fill" class="tool-btn" title="Fill (F)">‚ñ®</button>
                    <button id="tool-picker" class="tool-btn" title="Color Picker (I)">üé®</button>
                    <button id="tool-gradient" class="tool-btn" title="Gradient (G)">‚¨å</button>
                </div>
            </div>

            <!-- Shapes -->
            <div class="tool-section">
                <div class="section-label">Shapes</div>
                <div class="tool-buttons">
                    <button id="shape-rect" class="tool-btn" title="Rectangle (R)">‚ñ¢</button>
                    <button id="shape-ellipse" class="tool-btn" title="Ellipse (C)">‚óã</button>
                    <button id="shape-line" class="tool-btn" title="Line (L)">‚éØ</button>
                </div>
            </div>

            <!-- Selection -->
            <div class="tool-section">
                <div class="section-label">Selection</div>
                <div class="tool-buttons">
                    <button id="tool-select" class="tool-btn" title="Select (S)">‚¨ö</button>
                    <button id="tool-lasso" class="tool-btn" title="Lasso (A)">‚óØ</button>
                    <button id="tool-text" class="tool-btn" title="Text (T)">ùêì</button>
                </div>
            </div>

            <!-- Symmetry/Mirror -->
            <div class="tool-section">
                <div class="section-label">Symmetry</div>
                <div class="tool-buttons">
                    <button id="symmetry-none" class="tool-btn active" title="No Symmetry">‚äó</button>
                    <button id="symmetry-horizontal" class="tool-btn" title="Horizontal Mirror">‚¨å</button>
                    <button id="symmetry-vertical" class="tool-btn" title="Vertical Mirror">‚¨ç</button>
                    <button id="symmetry-radial" class="tool-btn" title="Radial Symmetry">‚ú±</button>
                </div>
            </div>

            <!-- Grid & Guides -->
            <div class="tool-section">
                <div class="section-label">Grid & Guides</div>
                <div class="control-row">
                    <label><input type="checkbox" id="grid-enabled"> Show Grid</label>
                </div>
                <div class="control-row">
                    <label>Size</label>
                    <input type="range" id="grid-size" min="10" max="100" value="20" step="5">
                    <span id="grid-size-value">20</span>
                </div>
                <div class="control-row">
                    <label><input type="checkbox" id="snap-to-grid"> Snap to Grid</label>
                </div>
            </div>

            <!-- Color & Size -->
            <div class="tool-section">
                <div class="section-label">Color & Size</div>

                <!-- Primary & Secondary Colors -->
                <div class="color-swatches-row">
                    <div class="color-swatch-container">
                        <div class="color-swatch-label">Primary</div>
                        <div id="color-display-primary" class="color-swatch large" title="Left click to pick (Primary)"></div>
                    </div>
                    <div class="color-swap-btn" id="swap-colors" title="Swap colors (X)">‚áÑ</div>
                    <div class="color-swatch-container">
                        <div class="color-swatch-label">Secondary</div>
                        <div id="color-display-secondary" class="color-swatch large" title="Right click to pick (Secondary)"></div>
                    </div>
                </div>

                <div class="control-row">
                    <input type="color" id="color-picker" value="#000000">
                    <div id="color-display" class="color-swatch" style="display: none;"></div>
                </div>

                <!-- Color History -->
                <div class="color-history-container">
                    <div class="color-history-label">Recent</div>
                    <div id="color-history" class="color-history"></div>
                </div>

                <!-- Preset Palette -->
                <div class="color-palette-container">
                    <div class="color-palette-label">Palette</div>
                    <div id="color-palette" class="color-palette"></div>
                </div>

                <div class="control-row">
                    <label>Size</label>
                    <input type="range" id="brush-size" min="1" max="50" value="4">
                    <span id="brush-size-value">4</span>
                </div>
                <div class="control-row">
                    <label>Tolerance</label>
                    <input type="range" id="fill-tolerance" min="0" max="60" value="10">
                    <span id="fill-tolerance-value">10</span>
                </div>
                <div class="control-row">
                    <label>Gradient</label>
                    <select id="gradient-type">
                        <option value="linear">Linear</option>
                        <option value="radial">Radial</option>
                    </select>
                </div>
            </div>

            <!-- Text Settings -->
            <div class="tool-section">
                <div class="section-label">Text</div>
                <div class="control-row">
                    <select id="font-family">
                        <option value="Arial">Arial</option>
                        <option value="Courier New">Courier</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times</option>
                        <option value="Verdana">Verdana</option>
                    </select>
                    <input type="number" id="font-size" min="8" max="200" value="24" style="width: 60px;">
                </div>
            </div>

            <!-- Actions -->
            <div class="tool-section">
                <div class="section-label">Actions</div>
                <div class="action-buttons">
                    <button id="btn-undo" class="action-btn" title="Undo (Ctrl+Z)">‚Ü∂</button>
                    <button id="btn-redo" class="action-btn" title="Redo (Ctrl+Y)">‚Ü∑</button>
                    <button id="btn-clear" class="action-btn" title="New">‚äï</button>
                    <button id="btn-open" class="action-btn" title="Open Image (Ctrl+O)">‚äû</button>
                    <button id="btn-save" class="action-btn" title="Save">‚ä°</button>
                    <button id="btn-help" class="action-btn" title="Help (? or H)">?</button>
                </div>
                <input type="file" id="file-input" accept="image/png,image/jpeg,image/jpg,image/webp" style="display: none;">
            </div>

            <!-- Accessibility (Experimental) -->
            <div class="tool-section">
                <div class="section-label">‚ôø Accessibility (PoC)</div>
                <button id="btn-eye-tracking" class="action-btn" title="Toggle Eye Tracking (Ctrl+Shift+E)" style="width: 100%; font-size: 16px; padding: 12px;">
                    üëÅÔ∏è Eye Tracking
                </button>
                <div style="font-size: 11px; color: #888; margin-top: 8px; line-height: 1.4;">
                    Ïã§ÌóòÏ†Å Í∏∞Îä•: ÏõπÏ∫†ÏúºÎ°ú ÏãúÏÑ† Ï∂îÏ†Å
                </div>
            </div>

            <!-- Export Format -->
            <div class="tool-section">
                <div class="section-label">Export</div>
                <div class="control-row">
                    <label>Format</label>
                    <select id="export-format">
                        <option value="png">PNG</option>
                        <option value="jpeg">JPEG</option>
                        <option value="webp">WebP</option>
                    </select>
                </div>
                <div class="control-row" id="quality-row">
                    <label>Quality</label>
                    <input type="range" id="export-quality" min="0" max="100" value="92">
                    <span id="export-quality-value">92%</span>
                </div>
            </div>

            <!-- Canvas Resize -->
            <div class="tool-section">
                <div class="section-label">Canvas Size</div>
                <div class="control-row">
                    <input type="number" id="canvas-width" min="100" max="2000" value="800" placeholder="Width">
                    <input type="number" id="canvas-height" min="100" max="2000" value="600" placeholder="Height">
                </div>
                <div class="control-row">
                    <label><input type="radio" name="resize-mode" value="scale" checked> Scale</label>
                    <label><input type="radio" name="resize-mode" value="crop"> Crop</label>
                </div>
                <button id="btn-resize" class="action-btn" title="Resize Canvas" style="width: 100%;">‚ÜîÔ∏è Resize</button>
            </div>

            <!-- Zoom Controls -->
            <div class="tool-section">
                <div class="section-label">Zoom</div>
                <div class="control-row">
                    <button id="btn-zoom-out" class="action-btn" title="Zoom Out (Ctrl+-)">‚àí</button>
                    <input type="range" id="zoom-slider" min="10" max="500" value="100">
                    <span id="zoom-value">100%</span>
                    <button id="btn-zoom-in" class="action-btn" title="Zoom In (Ctrl++)">+</button>
                </div>
                <div class="control-row">
                    <button id="btn-zoom-fit" class="action-btn" title="Fit to Screen">Fit</button>
                    <button id="btn-zoom-reset" class="action-btn" title="Reset Zoom (Ctrl+0)">100%</button>
                </div>
            </div>

            <!-- Layers -->
            <div class="tool-section">
                <div class="section-label" id="layer-count-label">Layers (1/20)</div>

                <!-- Layer Controls -->
                <div class="layer-controls">
                    <button id="btn-layer-add" class="layer-control-btn" title="Add Layer">+</button>
                    <button id="btn-layer-delete" class="layer-control-btn" title="Delete Layer">‚àí</button>
                    <button id="btn-layer-merge" class="layer-control-btn" title="Merge Down">‚¨á</button>
                    <button id="btn-layer-flatten" class="layer-control-btn" title="Flatten All">‚äü</button>
                </div>

                <!-- Layer List -->
                <div id="layer-list" class="layer-list">
                    <!-- Dynamically generated layer items -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Status Bar -->
    <div id="floating-status" class="floating-status">
        <span id="status-tool">Tool: Pen</span>
        <span id="status-coords">X: 0, Y: 0</span>
        <span id="status-zoom">Zoom: 100%</span>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Keyboard Shortcuts</h2>
                <button id="close-help" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-section">
                    <h3>Tools</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>P</kbd></td><td>Pen</td></tr>
                        <tr><td><kbd>E</kbd></td><td>Eraser</td></tr>
                        <tr><td><kbd>F</kbd></td><td>Fill (Bucket)</td></tr>
                        <tr><td><kbd>I</kbd></td><td>Color Picker (Eyedropper)</td></tr>
                        <tr><td><kbd>S</kbd></td><td>Selection Tool (Rectangle)</td></tr>
                        <tr><td><kbd>A</kbd></td><td>Lasso Tool (Free-form)</td></tr>
                        <tr><td><kbd>T</kbd></td><td>Text Tool</td></tr>
                    </table>
                </div>

                <div class="shortcuts-section">
                    <h3>Shapes</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>R</kbd></td><td>Rectangle</td></tr>
                        <tr><td><kbd>C</kbd></td><td>Circle (Ellipse)</td></tr>
                        <tr><td><kbd>L</kbd></td><td>Line</td></tr>
                    </table>
                </div>

                <div class="shortcuts-section">
                    <h3>Edit</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>Ctrl</kbd> + <kbd>Z</kbd></td><td>Undo</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>Y</kbd></td><td>Redo</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>C</kbd></td><td>Copy Selection</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>X</kbd></td><td>Cut Selection</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>V</kbd></td><td>Paste</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>O</kbd></td><td>Open Image File</td></tr>
                        <tr><td><kbd>Esc</kbd></td><td>Cancel Paste / Cancel Text</td></tr>
                    </table>
                </div>

                <div class="shortcuts-section">
                    <h3>Text Tool</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>Enter</kbd></td><td>Commit Text to Canvas</td></tr>
                        <tr><td><kbd>Esc</kbd></td><td>Cancel Text Input</td></tr>
                    </table>
                </div>

                <div class="shortcuts-section">
                    <h3>View</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>Ctrl</kbd> + <kbd>Wheel</kbd></td><td>Zoom In/Out (toward cursor)</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>+</kbd></td><td>Zoom In</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>-</kbd></td><td>Zoom Out</td></tr>
                        <tr><td><kbd>Ctrl</kbd> + <kbd>0</kbd></td><td>Reset Zoom to 100%</td></tr>
                        <tr><td><kbd>Space</kbd> + <kbd>Drag</kbd></td><td>Pan Canvas</td></tr>
                    </table>
                </div>

                <div class="shortcuts-section">
                    <h3>Help</h3>
                    <table class="shortcuts-table">
                        <tr><td><kbd>?</kbd> or <kbd>H</kbd></td><td>Show/Hide This Help</td></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- WebGazer.js for Eye Tracking (PoC) -->
    <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>

    <!-- Core modules (no dependencies) -->
    <script src="js/app-constants.js"></script>
    <script src="js/app-state.js"></script>

    <!-- Utilities (depend on core) -->
    <script src="js/zoom-pan.js"></script>

    <!-- Layer system (depends on core) -->
    <script src="js/layer-core.js"></script>

    <!-- History (depends on layer-core) -->
    <script src="js/history.js"></script>

    <!-- Tools (depend on layer-core, state) -->
    <script src="js/drawing-tools.js"></script>
    <script src="js/selection-tools.js"></script>

    <!-- File I/O (depends on layer-core, history) -->
    <script src="js/file-io.js"></script>

    <!-- Layer UI (depends on layer-core, history) -->
    <script src="js/layer-ui.js"></script>

    <!-- UI handlers - orchestrates everything (must be last) -->
    <script src="js/ui-handlers.js"></script>

    <!-- Eye Tracking PoC (experimental) -->
    <script src="js/eye-tracking-poc.js"></script>
</body>
</html>
