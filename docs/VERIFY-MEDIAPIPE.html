<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPipe íŒŒì¼ ì ‘ê·¼ì„± ê²€ì¦</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        h2 {
            color: #569cd6;
            margin-top: 30px;
        }
        .test-section {
            background: #2d2d2d;
            border: 1px solid #3e3e3e;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            background: #252526;
            border-radius: 4px;
        }
        .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .status.pending {
            background: #858585;
        }
        .status.success {
            background: #4ec9b0;
        }
        .status.error {
            background: #f48771;
        }
        .file-name {
            flex: 1;
            font-weight: bold;
            color: #ce9178;
        }
        .file-size {
            color: #858585;
            margin-left: 12px;
            min-width: 80px;
            text-align: right;
        }
        .status-text {
            color: #858585;
            margin-left: 12px;
            min-width: 100px;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.2s;
        }
        button:hover {
            background: #1177bb;
        }
        button:disabled {
            background: #3e3e3e;
            color: #858585;
            cursor: not-allowed;
        }
        .summary {
            background: #264f78;
            border-left: 4px solid #569cd6;
            padding: 16px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .summary.success {
            background: #1e4d3e;
            border-left-color: #4ec9b0;
        }
        .summary.error {
            background: #5a1d1d;
            border-left-color: #f48771;
        }
        .log {
            background: #1e1e1e;
            border: 1px solid #3e3e3e;
            padding: 16px;
            margin: 20px 0;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 13px;
            line-height: 1.6;
        }
        .log-entry {
            margin: 4px 0;
        }
        .log-entry.info {
            color: #569cd6;
        }
        .log-entry.success {
            color: #4ec9b0;
        }
        .log-entry.error {
            color: #f48771;
        }
        .log-entry.warn {
            color: #ce9178;
        }
        code {
            background: #1e1e1e;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: inherit;
        }
        .url-display {
            background: #1e1e1e;
            padding: 12px;
            border-radius: 4px;
            margin: 12px 0;
            border-left: 3px solid #569cd6;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>ğŸ‘ï¸ MediaPipe íŒŒì¼ ì ‘ê·¼ì„± ê²€ì¦ ë„êµ¬</h1>

    <div class="summary">
        <strong>ğŸ“‹ ëª©ì </strong><br>
        Eye Tracking PoCì— í•„ìš”í•œ MediaPipe íŒŒì¼ë“¤ì´ ì›¹ ì„œë²„ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œì§€ ê²€ì¦í•©ë‹ˆë‹¤.
    </div>

    <h2>ğŸŒ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì„œë²„</h2>
    <div class="test-section">
        <label for="base-url" style="display: block; margin-bottom: 8px; color: #569cd6;">Base URL:</label>
        <input type="text" id="base-url" value="https://paint.auoi.net"
               style="width: 100%; padding: 10px; background: #1e1e1e; color: #d4d4d4; border: 1px solid #3e3e3e; border-radius: 4px; font-family: inherit; font-size: 14px;">
        <p style="color: #858585; font-size: 13px; margin-top: 8px;">
            ë¡œì»¬ í…ŒìŠ¤íŠ¸: <code>http://127.0.0.1:5500</code> (Live Server)<br>
            í”„ë¡œë•ì…˜: <code>https://paint.auoi.net</code>
        </p>
    </div>

    <h2>ğŸ“ MediaPipe íŒŒì¼ ëª©ë¡</h2>
    <div class="test-section">
        <div id="file-tests"></div>
        <button id="btn-start-test" onclick="startTest()">ğŸš€ ê²€ì¦ ì‹œì‘</button>
        <button id="btn-test-direct" onclick="testDirectAccess()" style="margin-left: 12px;">ğŸ”— ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ê¸°</button>
    </div>

    <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
    <div id="summary-section"></div>

    <h2>ğŸ“ ìƒì„¸ ë¡œê·¸</h2>
    <div class="log" id="log-output"></div>

    <script>
        const MEDIAPIPE_FILES = [
            {
                path: '/mediapipe/face_mesh/face_mesh.binarypb',
                expectedSize: 939,
                description: 'MediaPipe FaceMesh ëª¨ë¸ ì •ì˜ íŒŒì¼'
            },
            {
                path: '/mediapipe/face_mesh/face_mesh_solution_packed_assets_loader.js',
                expectedSize: 8700,
                description: 'MediaPipe ì—ì…‹ ë¡œë” JavaScript'
            },
            {
                path: '/mediapipe/face_mesh/face_mesh_solution_simd_wasm_bin.js',
                expectedSize: 322000,
                description: 'MediaPipe WebAssembly ë°”ì´ë„ˆë¦¬ (SIMD)'
            }
        ];

        let testResults = [];

        // íŒŒì¼ ëª©ë¡ ë Œë”ë§
        function renderFileList() {
            const container = document.getElementById('file-tests');
            container.innerHTML = MEDIAPIPE_FILES.map((file, index) => `
                <div class="test-item" id="test-${index}">
                    <div class="status pending" id="status-${index}"></div>
                    <div class="file-name">${file.path}</div>
                    <div class="file-size" id="size-${index}">-</div>
                    <div class="status-text" id="text-${index}">ëŒ€ê¸° ì¤‘</div>
                </div>
            `).join('');
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message, type = 'info') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logOutput.appendChild(entry);
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        // ê°œë³„ íŒŒì¼ í…ŒìŠ¤íŠ¸
        async function testFile(baseUrl, file, index) {
            const url = baseUrl + file.path;
            const statusEl = document.getElementById(`status-${index}`);
            const sizeEl = document.getElementById(`size-${index}`);
            const textEl = document.getElementById(`text-${index}`);

            addLog(`í…ŒìŠ¤íŠ¸ ì‹œì‘: ${file.path}`, 'info');

            try {
                const response = await fetch(url, { method: 'HEAD' });

                if (response.ok) {
                    const contentLength = response.headers.get('Content-Length');
                    const size = contentLength ? parseInt(contentLength) : 0;

                    statusEl.className = 'status success';
                    sizeEl.textContent = formatBytes(size);
                    textEl.textContent = 'âœ… ì„±ê³µ';
                    textEl.style.color = '#4ec9b0';

                    const sizeMatch = size >= file.expectedSize * 0.9 && size <= file.expectedSize * 1.1;

                    addLog(`âœ… ${file.path} - ${response.status} ${response.statusText} (${formatBytes(size)})`, 'success');

                    if (!sizeMatch) {
                        addLog(`âš ï¸ íŒŒì¼ í¬ê¸° ë¶ˆì¼ì¹˜: ì˜ˆìƒ ${formatBytes(file.expectedSize)}, ì‹¤ì œ ${formatBytes(size)}`, 'warn');
                    }

                    return {
                        file: file.path,
                        success: true,
                        status: response.status,
                        size: size,
                        url: url
                    };
                } else {
                    statusEl.className = 'status error';
                    textEl.textContent = `âŒ ${response.status}`;
                    textEl.style.color = '#f48771';

                    addLog(`âŒ ${file.path} - ${response.status} ${response.statusText}`, 'error');

                    return {
                        file: file.path,
                        success: false,
                        status: response.status,
                        url: url
                    };
                }
            } catch (error) {
                statusEl.className = 'status error';
                textEl.textContent = 'âŒ ì‹¤íŒ¨';
                textEl.style.color = '#f48771';

                addLog(`âŒ ${file.path} - ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');

                return {
                    file: file.path,
                    success: false,
                    error: error.message,
                    url: url
                };
            }
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function startTest() {
            const baseUrl = document.getElementById('base-url').value.trim();
            if (!baseUrl) {
                alert('Base URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì´ˆê¸°í™”
            document.getElementById('log-output').innerHTML = '';
            document.getElementById('summary-section').innerHTML = '';
            testResults = [];

            const btn = document.getElementById('btn-start-test');
            btn.disabled = true;
            btn.textContent = 'â³ ê²€ì¦ ì¤‘...';

            addLog(`ğŸš€ í…ŒìŠ¤íŠ¸ ì‹œì‘: ${baseUrl}`, 'info');
            addLog(`ğŸ“ ì´ ${MEDIAPIPE_FILES.length}ê°œ íŒŒì¼ ê²€ì¦`, 'info');

            // ìˆœì°¨ í…ŒìŠ¤íŠ¸
            for (let i = 0; i < MEDIAPIPE_FILES.length; i++) {
                const result = await testFile(baseUrl, MEDIAPIPE_FILES[i], i);
                testResults.push(result);
            }

            // ê²°ê³¼ ìš”ì•½
            showSummary();

            btn.disabled = false;
            btn.textContent = 'ğŸš€ ê²€ì¦ ì‹œì‘';
        }

        // ê²°ê³¼ ìš”ì•½ í‘œì‹œ
        function showSummary() {
            const successCount = testResults.filter(r => r.success).length;
            const totalCount = testResults.length;
            const allSuccess = successCount === totalCount;

            const summarySection = document.getElementById('summary-section');

            if (allSuccess) {
                summarySection.innerHTML = `
                    <div class="summary success">
                        <strong>âœ… ëª¨ë“  íŒŒì¼ ì ‘ê·¼ ì„±ê³µ!</strong><br><br>
                        ${totalCount}ê°œ íŒŒì¼ì´ ëª¨ë‘ ì •ìƒì ìœ¼ë¡œ ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
                        Eye Tracking PoCë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                `;
                addLog(`ğŸ‰ ê²€ì¦ ì™„ë£Œ: ${successCount}/${totalCount} ì„±ê³µ`, 'success');
            } else {
                const failedFiles = testResults.filter(r => !r.success);
                summarySection.innerHTML = `
                    <div class="summary error">
                        <strong>âŒ ì¼ë¶€ íŒŒì¼ ì ‘ê·¼ ì‹¤íŒ¨</strong><br><br>
                        ì„±ê³µ: ${successCount}/${totalCount}<br>
                        ì‹¤íŒ¨í•œ íŒŒì¼:<br>
                        ${failedFiles.map(f => `â€¢ ${f.file} (${f.status || 'Network Error'})`).join('<br>')}
                        <br><br>
                        <strong>âš ï¸ Eye Tracking PoCê°€ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong><br>
                        ë°°í¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                addLog(`âš ï¸ ê²€ì¦ ì™„ë£Œ: ${successCount}/${totalCount} ì„±ê³µ, ${totalCount - successCount}ê°œ ì‹¤íŒ¨`, 'error');
            }

            // ì‹¤íŒ¨í•œ íŒŒì¼ì˜ URL í‘œì‹œ
            const failedFiles = testResults.filter(r => !r.success);
            if (failedFiles.length > 0) {
                failedFiles.forEach(f => {
                    addLog(`ğŸ”— ì‹¤íŒ¨í•œ URL: ${f.url}`, 'error');
                });
            }
        }

        // ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì—´ê¸°
        function testDirectAccess() {
            const baseUrl = document.getElementById('base-url').value.trim();
            if (!baseUrl) {
                alert('Base URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            addLog('ğŸ”— ë¸Œë¼ìš°ì € íƒ­ì—ì„œ MediaPipe íŒŒì¼ì„ ì§ì ‘ ì—½ë‹ˆë‹¤...', 'info');

            MEDIAPIPE_FILES.forEach((file, index) => {
                const url = baseUrl + file.path;
                setTimeout(() => {
                    window.open(url, `_mediapipe_${index}`);
                    addLog(`ğŸ”— ì—´ê¸°: ${url}`, 'info');
                }, index * 500);
            });

            addLog('ğŸ“Œ ê° íƒ­ì—ì„œ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ê±°ë‚˜ ë‚´ìš©ì´ í‘œì‹œë˜ë©´ ì„±ê³µì…ë‹ˆë‹¤.', 'info');
            addLog('ğŸ“Œ 404 Not Found í˜ì´ì§€ê°€ í‘œì‹œë˜ë©´ ë°°í¬ ë¬¸ì œì…ë‹ˆë‹¤.', 'warn');
        }

        // ì´ˆê¸°í™”
        renderFileList();
        addLog('ğŸ’¡ Base URLì„ ì…ë ¥í•˜ê³  "ê²€ì¦ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
        addLog('ğŸ’¡ ë¡œì»¬ í…ŒìŠ¤íŠ¸: http://127.0.0.1:5500 (Live Server)', 'info');
        addLog('ğŸ’¡ í”„ë¡œë•ì…˜ í…ŒìŠ¤íŠ¸: https://paint.auoi.net', 'info');
    </script>
</body>
</html>
